{"version":3,"file":"record.min.js","sources":["../src/record.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Video assessment\n *\n * @package\n * @module     mod_videoassessment/record\n * @copyright  2024 Don Hinkleman (hinkelman@mac.com)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/* global RecordRTC */\ndefine([\n    'mod_videoassessment/media',\n    'mod_videoassessment/uploader'\n], function (media, uploader) {\n\n    /**\n     * Initializes the recording UI and logic.\n     */\n    function init() {\n        const btnStart = document.querySelector('#btn-start-recording');\n        const btnPause = document.querySelector('#btn-pause-recording');\n        let recorder, stream;\n\n        btnStart.addEventListener('click', function () {\n            if (recorder && recorder.getState() === 'recording') {\n                recorder.stopRecording(() => {\n                    const blob = recorder.getBlob();\n                    uploader.upload(blob, recorder.mimeType);\n                });\n                return;\n            }\n\n            media.captureUserMedia((userStream) => {\n                stream = userStream;\n                recorder = new RecordRTC(stream, {\n                    type: 'video',\n                    mimeType: 'video/webm',\n                    disableLogs: false\n                });\n\n                recorder.startRecording();\n                btnPause.style.display = '';\n                btnStart.textContent = M.str.videoassessment.stoprecording;\n            }, (err) => {\n                alert(M.str.videoassessment.errorcapturingmedia + ' ' + err.message);\n            });\n        });\n\n        btnPause.addEventListener('click', function () {\n            if (!recorder) { return; }\n            if (btnPause.textContent === M.str.videoassessment.pause) {\n                recorder.pauseRecording();\n                btnPause.textContent = M.str.videoassessment.resumerecording;\n            } else {\n                recorder.resumeRecording();\n                btnPause.textContent = M.str.videoassessment.pause;\n            }\n        });\n    }\n\n    return {\n        reCord: init\n    };\n});"],"names":["define","media","uploader","reCord","btnStart","document","querySelector","btnPause","recorder","stream","addEventListener","getState","stopRecording","blob","getBlob","upload","mimeType","captureUserMedia","userStream","RecordRTC","type","disableLogs","startRecording","style","display","textContent","M","str","videoassessment","stoprecording","err","alert","errorcapturingmedia","message","pause","pauseRecording","resumerecording","resumeRecording"],"mappings":";;;;;;;;AAyBAA,oCAAO,CACH,4BACA,iCACD,SAAUC,MAAOC,gBA+CT,CACHC,wBA1CMC,SAAWC,SAASC,cAAc,wBAClCC,SAAWF,SAASC,cAAc,4BACpCE,SAAUC,OAEdL,SAASM,iBAAiB,SAAS,WAC3BF,UAAoC,cAAxBA,SAASG,WACrBH,SAASI,eAAc,WACbC,KAAOL,SAASM,UACtBZ,SAASa,OAAOF,KAAML,SAASQ,aAKvCf,MAAMgB,kBAAkBC,aACpBT,OAASS,WACTV,SAAW,IAAIW,UAAUV,OAAQ,CAC7BW,KAAM,QACNJ,SAAU,aACVK,aAAa,IAGjBb,SAASc,iBACTf,SAASgB,MAAMC,QAAU,GACzBpB,SAASqB,YAAcC,EAAEC,IAAIC,gBAAgBC,iBAC7CC,MACAC,MAAML,EAAEC,IAAIC,gBAAgBI,oBAAsB,IAAMF,IAAIG,eAIpE1B,SAASG,iBAAiB,SAAS,WAC1BF,WACDD,SAASkB,cAAgBC,EAAEC,IAAIC,gBAAgBM,OAC/C1B,SAAS2B,iBACT5B,SAASkB,YAAcC,EAAEC,IAAIC,gBAAgBQ,kBAE7C5B,SAAS6B,kBACT9B,SAASkB,YAAcC,EAAEC,IAAIC,gBAAgBM"}