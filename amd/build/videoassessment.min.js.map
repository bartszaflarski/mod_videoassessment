{"version":3,"file":"videoassessment.min.js","sources":["../src/videoassessment.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Video assessment\n *\n * @package\n * @module     mod_videoassessment/videoassessment\n * @copyright  2024 Don Hinkleman (hinkelman@mac.com)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'jquery',\n    'core/str',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/notification',\n    'core/ajax',\n], function ($, Str, ModalFactory, ModalEvents, Notification, Ajax) {\n    'use strict';\n\n    const SELECTORS = {\n        commentButton: '.commentbutton',\n        uploadButton: '#id_submitbutton',\n        mobileForm: '#mobileform',\n        mobileVideoInput: '#id_mobilevideo',\n        videoError: '#id_error_mobilevideo',\n        uploadProgress: '.upload-progress',\n    };\n\n    const mobileshowallcomment = () => {\n        $(SELECTORS.commentButton).on('click', function () {\n            const request = {\n                methodname: 'mod_videoassessment_get_getallcomments',\n                args: {\n                    ajax: 1,\n                    action: 'getallcomments',\n                    userid: $(this).attr('userid'),\n                    timing: $(this).attr('timing'),\n                    cmid: $(this).attr('cmid'),\n                    id: $(this).attr('id')\n                }\n            };\n\n            Ajax.call([request])[0]\n                .then((response) => {\n                    if (response.html) {\n                        ModalFactory.create({\n                            type: ModalFactory.types.CANCEL,\n                            title: `<h1>${M.str.videoassessment.generalcomments}</h1>`,\n                            body: response.html,\n                        }).then(modal => modal.show())\n                            .catch(Notification.exception);\n                    }\n                })\n                .catch(Notification.exception);\n        });\n    };\n\n    const init_message_sent_window = (messageSent) => {\n        if (parseInt(messageSent, 10) === 1) {\n            Str.get_string('notificationmessagesent', 'videoassessment').then((message) => {\n                ModalFactory.create({\n                    type: ModalFactory.types.DEFAULT,\n                    title: '',\n                    body: `<h2>${message}</h2>`,\n                }).then(modal => {\n                    modal.show();\n                    setTimeout(() => modal.hide(), 2000);\n                }).catch(Notification.exception);\n            }).catch(Notification.exception);\n        }\n    };\n\n    const init_upload_file_step = () => {\n        // Placeholder\n    };\n\n    const init_mobile_upload_progress_bar = () => {\n        $(SELECTORS.uploadButton).on('click', function (e) {\n            const uploadType = $('input[name=\"upload\"]:checked').val();\n            const videoFile = $(SELECTORS.mobileVideoInput)[0].files[0];\n\n            window.onbeforeunload = null;\n\n            if (uploadType === '1') {\n                $(SELECTORS.mobileForm).submit();\n                return;\n            }\n\n            e.preventDefault();\n\n            const url = $(SELECTORS.mobileForm).attr('action');\n            const formData = new FormData($(SELECTORS.mobileForm)[0]);\n            const id = formData.get('id');\n\n            const submitForm = () => {\n                $.ajax({\n                    url: url,\n                    type: 'POST',\n                    data: formData,\n                    processData: false,\n                    contentType: false,\n                    xhr: () => {\n                        const xhr = new XMLHttpRequest();\n                        if (xhr.upload) {\n                            xhr.upload.addEventListener('progress', () => {\n                                $(SELECTORS.uploadProgress).show();\n                            });\n                        }\n                        return xhr;\n                    },\n                    success: (data) => {\n                        try {\n                            if (data && data.action) {\n                                window.location.href = `${url}?action=${data.action}&id=${id}`;\n                            } else {\n                                window.location.href = `${url}?id=${id}`;\n                            }\n                        } catch (error) {\n                            Notification.exception(error);\n                        }\n                    },\n                    error: Notification.exception,\n                });\n            };\n\n            if (!videoFile) {\n                $(SELECTORS.videoError).text(M.str.videoassessment.erroruploadvideo).show();\n                return false;\n            }\n\n            if (videoFile.size > 500000000) {\n                Str.get_strings([\n                    { key: 'uploadmessage', component: 'videoassessment' },\n                    { key: 'upload', component: 'moodle' },\n                    { key: 'cancel', component: 'moodle' },\n                ]).then(strings => {\n                    Notification.confirm(strings[0], '', strings[1], strings[2])\n                        .then(submitForm)\n                        .catch(() => { });\n                }).catch(Notification.exception);\n            } else {\n                submitForm();\n            }\n        });\n    };\n\n    return {\n        mobileshowallcomment,\n        init_message_sent_window,\n        init_upload_file_step,\n        init_mobile_upload_progress_bar\n    };\n});"],"names":["define","$","Str","ModalFactory","ModalEvents","Notification","Ajax","SELECTORS","mobileshowallcomment","on","request","methodname","args","ajax","action","userid","this","attr","timing","cmid","id","call","then","response","html","create","type","types","CANCEL","title","M","str","videoassessment","generalcomments","body","modal","show","catch","exception","init_message_sent_window","messageSent","parseInt","get_string","message","DEFAULT","setTimeout","hide","init_upload_file_step","init_mobile_upload_progress_bar","e","uploadType","val","videoFile","files","window","onbeforeunload","submit","preventDefault","url","formData","FormData","get","submitForm","data","processData","contentType","xhr","XMLHttpRequest","upload","addEventListener","success","location","href","error","text","erroruploadvideo","size","get_strings","key","component","strings","confirm"],"mappings":";;;;;;;;AAuBAA,6CAAO,CACH,SACA,WACA,qBACA,oBACA,oBACA,cACD,SAAUC,EAAGC,IAAKC,aAAcC,YAAaC,aAAcC,YAGpDC,wBACa,iBADbA,uBAEY,mBAFZA,qBAGU,cAHVA,2BAIgB,kBAJhBA,qBAKU,wBALVA,yBAMc,yBAyHb,CACHC,qBAvHyB,KACzBP,EAAEM,yBAAyBE,GAAG,SAAS,iBAC7BC,QAAU,CACZC,WAAY,yCACZC,KAAM,CACFC,KAAM,EACNC,OAAQ,iBACRC,OAAQd,EAAEe,MAAMC,KAAK,UACrBC,OAAQjB,EAAEe,MAAMC,KAAK,UACrBE,KAAMlB,EAAEe,MAAMC,KAAK,QACnBG,GAAInB,EAAEe,MAAMC,KAAK,QAIzBX,KAAKe,KAAK,CAACX,UAAU,GAChBY,MAAMC,WACCA,SAASC,MACTrB,aAAasB,OAAO,CAChBC,KAAMvB,aAAawB,MAAMC,OACzBC,oBAAcC,EAAEC,IAAIC,gBAAgBC,yBACpCC,KAAMX,SAASC,OAChBF,MAAKa,OAASA,MAAMC,SAClBC,MAAMhC,aAAaiC,cAG/BD,MAAMhC,aAAaiC,eA+F5BC,yBA3F8BC,cACI,IAA9BC,SAASD,YAAa,KACtBtC,IAAIwC,WAAW,0BAA2B,mBAAmBpB,MAAMqB,UAC/DxC,aAAasB,OAAO,CAChBC,KAAMvB,aAAawB,MAAMiB,QACzBf,MAAO,GACPK,mBAAaS,mBACdrB,MAAKa,QACJA,MAAMC,OACNS,YAAW,IAAMV,MAAMW,QAAQ,QAChCT,MAAMhC,aAAaiC,cACvBD,MAAMhC,aAAaiC,YAiF1BS,sBA7E0B,OA8E1BC,gCA1EoC,KACpC/C,EAAEM,wBAAwBE,GAAG,SAAS,SAAUwC,SACtCC,WAAajD,EAAE,gCAAgCkD,MAC/CC,UAAYnD,EAAEM,4BAA4B,GAAG8C,MAAM,MAEzDC,OAAOC,eAAiB,KAEL,MAAfL,uBACAjD,EAAEM,sBAAsBiD,SAI5BP,EAAEQ,uBAEIC,IAAMzD,EAAEM,sBAAsBU,KAAK,UACnC0C,SAAW,IAAIC,SAAS3D,EAAEM,sBAAsB,IAChDa,GAAKuC,SAASE,IAAI,MAElBC,WAAa,KACf7D,EAAEY,KAAK,CACH6C,IAAKA,IACLhC,KAAM,OACNqC,KAAMJ,SACNK,aAAa,EACbC,aAAa,EACbC,IAAK,WACKA,IAAM,IAAIC,sBACZD,IAAIE,QACJF,IAAIE,OAAOC,iBAAiB,YAAY,KACpCpE,EAAEM,0BAA0B6B,UAG7B8B,KAEXI,QAAUP,WAEEA,MAAQA,KAAKjD,OACbwC,OAAOiB,SAASC,eAAUd,uBAAcK,KAAKjD,sBAAaM,IAE1DkC,OAAOiB,SAASC,eAAUd,mBAAUtC,IAE1C,MAAOqD,OACLpE,aAAaiC,UAAUmC,SAG/BA,MAAOpE,aAAaiC,iBAIvBc,iBACDnD,EAAEM,sBAAsBmE,KAAK5C,EAAEC,IAAIC,gBAAgB2C,kBAAkBvC,QAC9D,EAGPgB,UAAUwB,KAAO,IACjB1E,IAAI2E,YAAY,CACZ,CAAEC,IAAK,gBAAiBC,UAAW,mBACnC,CAAED,IAAK,SAAUC,UAAW,UAC5B,CAAED,IAAK,SAAUC,UAAW,YAC7BzD,MAAK0D,UACJ3E,aAAa4E,QAAQD,QAAQ,GAAI,GAAIA,QAAQ,GAAIA,QAAQ,IACpD1D,KAAKwC,YACLzB,OAAM,YACZA,MAAMhC,aAAaiC,WAEtBwB"}