{"version":3,"file":"mod_form.min.js","sources":["../src/mod_form.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Video assessment\n *\n * @package\n * @module     mod_videoassessment/mod_form\n * @copyright  2024 Don Hinkleman (hinkelman@mac.com)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery'], function ($) {\n\n    /**\n     * Initializes the behavior of the training selector.\n     *\n     * Shows or hides the training video, accepted difference, and description\n     * fields based on the selected training option.\n     */\n    function initTrainingChange() {\n        const training = $('#id_training');\n        const video = $('#fitem_id_trainingvideo');\n        const point = $('#fitem_id_accepteddifference');\n        const desc = $('#fitem_id_trainingdesc');\n\n        if (training.length) {\n            if (training.val() != 1) {\n                video.hide();\n                point.hide();\n                desc.hide();\n            }\n\n            training.on('change', function () {\n                if ($(this).val() == 1) {\n                    video.show();\n                    point.show();\n                    desc.show();\n                } else {\n                    video.hide();\n                    point.hide();\n                    desc.hide();\n                }\n            });\n        }\n    }\n\n    /**\n     * Initializes peer assessment option change handling.\n     *\n     * Automatically selects \"1\" as the number of peers when a peer assessment\n     * value greater than 0 is chosen.\n     */\n    function initQuickSetupPeerChange() {\n        const peerAssess = $('#id_peerassess');\n        peerAssess.on('change', function () {\n            if ($(this).val() > 0) {\n                $('#id_numberofpeers').find('option[value=\"1\"]').prop('selected', true);\n            }\n        });\n    }\n\n    /**\n     * Initializes display toggling for fairness bonus and self-fairness bonus fields.\n     *\n     * Shows or hides relevant bonus percentage and score fields based on whether\n     * the corresponding toggle is enabled.\n     */\n    function initFairnessBonusChange() {\n        /**\n         * Toggles visibility of specified form fields based on the value of a toggle input.\n         *\n         * If the toggle field's value is `1`, the given fields will be shown;\n         * otherwise, they will be hidden. Also attaches a change listener to update\n         * visibility dynamically when the user changes the toggle input.\n         *\n         * @param {string} toggleId - jQuery selector for the toggle input element.\n         * @param {string[]} fields - Array of jQuery selectors for the fields to show/hide.\n         */\n        function toggleBonusFields(toggleId, fields) {\n            const toggle = $(toggleId);\n            if (toggle.length) {\n                const val = toggle.val();\n                if (val != 1) {\n                    fields.forEach(f => $(f).hide());\n                }\n\n                toggle.on('change', function () {\n                    if ($(this).val() == 1) {\n                        fields.forEach(f => $(f).show());\n                    } else {\n                        fields.forEach(f => $(f).hide());\n                    }\n                });\n            }\n        }\n\n        toggleBonusFields('#id_fairnessbonus', [\n            '#fitem_id_bonuspercentage',\n            '#fgroup_id_bonusscoregroup1',\n            '#fgroup_id_bonusscoregroup2',\n            '#fgroup_id_bonusscoregroup3',\n            '#fgroup_id_bonusscoregroup4',\n            '#fgroup_id_bonusscoregroup5',\n            '#fgroup_id_bonusscoregroup6'\n        ]);\n\n        toggleBonusFields('#id_selffairnessbonus', [\n            '#fitem_id_selfbonuspercentage',\n            '#fgroup_id_selfbonusscoregroup1',\n            '#fgroup_id_selfbonusscoregroup2',\n            '#fgroup_id_selfbonusscoregroup3',\n            '#fgroup_id_selfbonusscoregroup4',\n            '#fgroup_id_selfbonusscoregroup5',\n            '#fgroup_id_selfbonusscoregroup6'\n        ]);\n    }\n\n    /**\n     * Initializes logic for switching between video upload types.\n     *\n     * Toggles visibility of relevant form fields for uploading a video file,\n     * linking to YouTube, or recording a new video. Also reorders some form\n     * elements for better UX on mobile.\n     */\n    function initUploadTypeChange() {\n        const uploadRadio = $('#id_upload_0');\n        const youtubeRadio = $('#id_upload_1');\n        const recordNewVideo = $('#id_upload_2');\n\n        const precent = $('#fitem_id_precent').length ? $('#fitem_id_precent') : $('#fitem_id_mobilevideo');\n        const video = $('#fitem_id_video').length ? $('#fitem_id_video') : $('#fitem_id_mobilevideo');\n        const url = $('#id_url').length ? $('#id_url') : $('#id_mobileurl');\n        const recordContent = $('#recordrtc');\n        const submitButtons = $('#fgroup_id_buttonar');\n\n        if ($('#mobileform').length) {\n            $('#fgroup_id_recordradios').hide();\n        }\n\n        $('.col-md-3').each(function () {\n            if ($(this).children().length == 0) {\n                $(this).remove();\n            }\n        });\n\n        const rearrangeRadios = (groupId, radioId) => {\n            if ($(groupId).length) {\n                const radio = $(radioId).parent();\n                const target = $(groupId).children('div').first();\n                const label = $(groupId).find('span a');\n                target.append(radio);\n                target.append(label);\n            }\n        };\n\n        rearrangeRadios('#fgroup_id_radios', '#id_upload_1');\n        rearrangeRadios('#fgroup_id_recordradios', '#id_upload_2');\n\n        const actionVal = $('.actionmodel').val();\n        if (actionVal == 1) {\n            $('#id_upload_0').prop('checked', false);\n            youtubeRadio.prop('checked', true);\n        } else {\n            $('#id_upload_1').prop('checked', false);\n            uploadRadio.prop('checked', true);\n        }\n\n        const updateVisibility = () => {\n            if (uploadRadio.is(':checked')) {\n                url.hide();\n                recordContent.hide();\n                video.show();\n                precent.show();\n                submitButtons.show();\n            } else if (youtubeRadio.is(':checked')) {\n                video.hide();\n                precent.hide();\n                recordContent.hide();\n                url.show();\n                submitButtons.show();\n            } else if (recordNewVideo.is(':checked')) {\n                video.hide();\n                url.hide();\n                precent.hide();\n                recordContent.show();\n                submitButtons.hide();\n            }\n        };\n\n        uploadRadio.on('change', updateVisibility);\n        youtubeRadio.on('change', updateVisibility);\n        recordNewVideo.on('change', updateVisibility);\n        updateVisibility();\n    }\n\n    /**\n     * Initializes the notification settings form toggle behavior.\n     *\n     * Enables expand/collapse toggling for each notification group section and\n     * adjusts form field layout styles.\n     */\n    function initNotificationFormChange() {\n        const toggleGroup = (btnClass, groupId) => {\n            $(document).on('click', btnClass, function (e) {\n                e.preventDefault();\n                const btn = $(this);\n                if (btn.hasClass('expanded')) {\n                    btn.removeClass('expanded').addClass('collapsed');\n                    $(groupId).hide();\n                } else {\n                    btn.removeClass('collapsed').addClass('expanded');\n                    $(groupId).show();\n                }\n            });\n        };\n\n        toggleGroup('.teacher-notification-displaybtn', '#fgroup_id_teachernotificationgroup');\n        toggleGroup('.reminder-notification-displaybtn', '#fgroup_id_remindernotificationgroup');\n        toggleGroup('.peer-notification-displaybtn', '#fgroup_id_peernotificationgroup');\n        toggleGroup('.video-notification-displaybtn', '#fgroup_id_videonotificationgroup');\n\n        $('#fgroup_id_teachernotificationgroup').hide();\n        $('#fgroup_id_remindernotificationgroup').hide();\n        $('#fgroup_id_peernotificationgroup').hide();\n        $('#fgroup_id_videonotificationgroup').hide();\n\n        $('#id_isbeforeduedate').parent().css('width', 'auto');\n        $('#id_isafterduedate').parent().css('width', 'auto');\n    }\n\n    return {\n        initTrainingChange: initTrainingChange,\n        initQuickSetupPeerChange: initQuickSetupPeerChange,\n        initFairnessBonusChange: initFairnessBonusChange,\n        initUploadTypeChange: initUploadTypeChange,\n        initNotificationFormChange: initNotificationFormChange\n    };\n});\n"],"names":["define","$","initTrainingChange","training","video","point","desc","length","val","hide","on","this","show","initQuickSetupPeerChange","find","prop","initFairnessBonusChange","toggleBonusFields","toggleId","fields","toggle","forEach","f","initUploadTypeChange","uploadRadio","youtubeRadio","recordNewVideo","precent","url","recordContent","submitButtons","each","children","remove","rearrangeRadios","groupId","radioId","radio","parent","target","first","label","append","updateVisibility","is","initNotificationFormChange","toggleGroup","btnClass","document","e","preventDefault","btn","hasClass","removeClass","addClass","css"],"mappings":"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"}