/**
 * Video assessment
 *
 * @package
 * @module     mod_videoassessment/videoassessment
 * @copyright  2024 Don Hinkleman (hinkelman@mac.com)
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_videoassessment/videoassessment",["jquery","core/str","core/modal_factory","core/modal_events","core/notification","core/ajax"],(function($,Str,ModalFactory,ModalEvents,Notification,Ajax){const SELECTORS_commentButton=".commentbutton",SELECTORS_uploadButton="#id_submitbutton",SELECTORS_mobileForm="#mobileform",SELECTORS_mobileVideoInput="#id_mobilevideo",SELECTORS_videoError="#id_error_mobilevideo",SELECTORS_uploadProgress=".upload-progress";return{mobileshowallcomment:()=>{$(SELECTORS_commentButton).on("click",(function(){const request={methodname:"mod_videoassessment_get_getallcomments",args:{ajax:1,action:"getallcomments",userid:$(this).attr("userid"),timing:$(this).attr("timing"),cmid:$(this).attr("cmid"),id:$(this).attr("id")}};Ajax.call([request])[0].then((response=>{response.html&&ModalFactory.create({type:ModalFactory.types.CANCEL,title:"<h1>".concat(M.str.videoassessment.generalcomments,"</h1>"),body:response.html}).then((modal=>modal.show())).catch(Notification.exception)})).catch(Notification.exception)}))},init_message_sent_window:messageSent=>{1===parseInt(messageSent,10)&&Str.get_string("notificationmessagesent","videoassessment").then((message=>{ModalFactory.create({type:ModalFactory.types.DEFAULT,title:"",body:"<h2>".concat(message,"</h2>")}).then((modal=>{modal.show(),setTimeout((()=>modal.hide()),2e3)})).catch(Notification.exception)})).catch(Notification.exception)},init_upload_file_step:()=>{},init_mobile_upload_progress_bar:()=>{$(SELECTORS_uploadButton).on("click",(function(e){const uploadType=$('input[name="upload"]:checked').val(),videoFile=$(SELECTORS_mobileVideoInput)[0].files[0];if(window.onbeforeunload=null,"1"===uploadType)return void $(SELECTORS_mobileForm).submit();e.preventDefault();const url=$(SELECTORS_mobileForm).attr("action"),formData=new FormData($(SELECTORS_mobileForm)[0]),id=formData.get("id"),submitForm=()=>{$.ajax({url:url,type:"POST",data:formData,processData:!1,contentType:!1,xhr:()=>{const xhr=new XMLHttpRequest;return xhr.upload&&xhr.upload.addEventListener("progress",(()=>{$(SELECTORS_uploadProgress).show()})),xhr},success:data=>{try{data&&data.action?window.location.href="".concat(url,"?action=").concat(data.action,"&id=").concat(id):window.location.href="".concat(url,"?id=").concat(id)}catch(error){Notification.exception(error)}},error:Notification.exception})};if(!videoFile)return $(SELECTORS_videoError).text(M.str.videoassessment.erroruploadvideo).show(),!1;videoFile.size>5e8?Str.get_strings([{key:"uploadmessage",component:"videoassessment"},{key:"upload",component:"moodle"},{key:"cancel",component:"moodle"}]).then((strings=>{Notification.confirm(strings[0],"",strings[1],strings[2]).then(submitForm).catch((()=>{}))})).catch(Notification.exception):submitForm()}))}}}));

//# sourceMappingURL=videoassessment.min.js.map